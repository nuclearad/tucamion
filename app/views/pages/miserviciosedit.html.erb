<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">
            Servicios <small>/ editar</small>
            </h1>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <%= render partial: 'includes/messages_errors', locals: {object: @service} %>
            <%= form_for @service, :url => miserviciosedit_path, method: :post do |f|  %>
                <% if @serviceLateUpdate %>
                    <div class="row">
                        <div class="col-md-4">
                            <div class="form-group">
                                <%= f.label :price, 'Precio' %>
                                <%= f.number_field :price, :class =>'form-control text_field'  %>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <div class="form-group">
                                <%= f.label :telefono, 'Telefono' %>
                                <%= f.number_field :telefono, :class =>'form-control'  %>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="form-group">
                                <%= f.label :email, 'Email' %>
                                <%= f.text_field :email, :class =>'form-control', :autocorrect=>'off' %>
                            </div>
                        </div>
                        
                    </div>
                
                <% else %>
                    <!--Nombre y Tipo -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <%= f.label :name, 'Nombre de servicio' %>
                                <%= f.text_field :name, :class =>'form-control'  %>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <%= f.label :type_service_id, 'Tipo de servicio' %>
                                <%= f.collection_select :type_service_id, TypeService.order(:name),:id,:name, {prompt: 'Selecccione'}, {class: 'form-control'} %>
                            </div>
                        </div>    
                    </div>

                    <!--Departamento y Ciudad -->
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <%= f.label :state_id, 'Departamento' %>
                                <%= f.collection_select :state_id, State.order(:id),:id,:name, {prompt: 'Selecccione'}, {class: 'form-control'} %>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <%= f.label :city_id, 'Ciudad' %>
                                <%= f.collection_select :city_id, @cities.order(:name),:id,:name, {}, { class: 'form-control'} %>
                            </div>
                        </div>
                    </div>
                    
                    <!--Direccion y Horario -->    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <%= f.label :address, 'Dirección' %>
                                <%= f.text_field :address, :class =>'form-control'  %>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="form-group">
                                <%= f.label :horario, 'Horario de atencion' %>
                                <%= f.collection_select :horario, @horas,:first,:first,{prompt:'Selecciones'},{class: 'form-control text_field'} %>
                            </div>
                        </div>
                    </div>

                    <!--Telefono y Email -->
                    <div class="row">
                        <div class='col-md-6'>
                            <div class="form-group">
                                <%= f.label :phone, 'Teléfono' %>
                                <%= f.number_field :phone, :class =>'form-control', maxlength: 11  %>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <%= f.label :email, 'Email' %>
                                <%= f.email_field :email, :class =>'form-control', minlength: 1 %>
                            </div>
                        </div>
                    </div>                    
                    
                    <!-- Descripcion -->
                    <div class="row">
                        <div class="col-md-12">
                            <%= f.label :description, 'Descripccion' %>
                            <%= f.text_area :description, :class =>'form-control'  %> <br/> <br/>
                        </div>
                    </div>
                    
                    <!--Imagenes-->    
                    <%= render partial: 'shared/imagenes', locals:{ object: f } %>
                
                <%end%>
                <%= render partial: 'shared/botonera', locals:{ object: f, cancel_route: miservicios_path } %>
            <% end %>
        </div>
    </div>

</div>

<script>
    var ready;
    ready = function() {



        $('#truck_city_id option').html('');
        function loader(data){
            $('#truck_city_id option').html('Cargando...');
        }

        function error(data){
            alert("Error enviados los datos");
        }



        $.ajax({
            async: true,
            type: "GET",
            dataType: 'json',
            beforeSend:loader,
            error:error,
            success: function (msg) {


                $('#service_city_id').html('');


                $.each(msg, function(index, value) {
                    console.log('<option value="'+value.id+'">'+value.name+'</option>');

                    if(value.id == <%= @service.city_id %>){
                        $('#service_city_id').append('<option selected value="'+value.id+'">'+value.name+'</option>')
                    }else{
                        $('#service_city_id').append('<option value="'+value.id+'">'+value.name+'</option>')
                    }


                });

            },
            url:"/admin/states/<%= @service.state_id %>/cities.json"
        });




        $('#service_state_id').on('change', function() {

            $('#truck_city_id option').html('');
            function loader(data){
                $('#truck_city_id option').html('Cargando...')
            }

            function error(data){
                alert("Error enviados los datos");
            }



            $.ajax({
                async: true,
                type: "GET",
                dataType: 'json',
                beforeSend:loader,
                error:error,
                success: function (msg) {


                    $('#service_city_id').html('');


                    $.each(msg, function(index, value) {
                        console.log('<option value="'+value.id+'">'+value.name+'</option>');
                        $('#service_city_id').append('<option value="'+value.id+'">'+value.name+'</option>');
                    });

                },
                url:"/admin/states/"+this.value+"/cities.json"
            });


        });

    };

    $(document).ready(ready);
    $(document).on('page:load', ready);


</script>