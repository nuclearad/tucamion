<div class="row">
  <div class="col-lg-12">
    <h1 class="page-header">
      Repuestos <small>/ Agregar</small>
    </h1>

  </div>
</div>


<div class="row">
  <div class="col-md-12">

    <%= render partial: 'includes/messages_errors', locals: {object: @extra} %>
    <%= form_for @extra, :url => mirepuestosnew_path  do |f|  %>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <%= f.label :name, 'Nombre de repuesto' %>
            <%= f.text_field :name, :class =>'form-control'  %>
          </div>
        </div>

        <div class="col-md-6">
          <div class="form-group">
            <%= f.label :price, 'Precio' %>
            <%= f.number_field :price, :class =>'form-control text_field'  %>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <%= f.label :address, 'Dirección' %>
            <%= f.text_field :address, :class =>'form-control'  %>
          </div>
        </div>

        <div class="col-md-6">
            <div class="form-group">
              <%= f.label :horario, 'Horario de atencion' %>
              <%= f.collection_select :horario, @horas,:last,:first,{},{class: 'form-control text_field'} %>
            </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <%= f.label :phone, 'Teléfono' %>
            <%= f.text_field :phone, :class =>'form-control', maxlength: 11  %>
          </div>
        </div>
        <div class="col-md-6">
          <div class="form-group">
            <%= f.label :email, 'Email' %>
            <%= f.email_field :email, :class =>'form-control' minlength: 1 %>
          </div>
        </div>
      </div>

      <div class="row">

        <div class="col-md-6">
          <div class="form-group">
            <%= f.label :type_truck_id, 'Tipo de Camion' %>
            <%= f.collection_select :type_truck_id, TypeTruck.order(:name),:id,:name, {prompt: 'Selecccione'}, {class: 'form-control'} %>
          </div>
        </div>

        <div class="col-md-6">

          <div class="form-group">
            <%= f.label :brand_extra_id, 'Marca' %>
            <%= f.collection_select :brand_extra_id, BrandExtra.order(:name),:id,:name, {prompt: 'Selecccione'}, {class: 'form-control'} %>
          </div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6">
          <div class="form-group">
            <%= f.label :state_id, 'Departamento' %>
            <%= f.collection_select :state_id, State.order(:id),:id,:name, {prompt: 'Selecccione'}, {class: 'form-control'} %>
          </div>
        </div>


        <div class="col-md-6">
          <div class="form-group">
            <%= f.label :city_id, 'Ciudad' %>
            <% if @extra.city_id.nil? %>
              <%= f.select(:city_id, [['','' ]], {}, { :class => 'form-control' }) %>
            <% else %>
              <%= f.collection_select(:city_id, City.getByState(@extra.state_id).order(:name),:id,:name, {}, { :class => 'form-control' }) %>
            <% end %>
          </div>
        </div>
      </div>

      <%= render partial: 'shared/imagenes', locals:{ object: f } %>
      
      <div class="row">
        <div class="col-md-12">
          <%= f.label :description, 'Descripccion' %>
          <%= f.text_area :description, :class =>'form-control'  %> <br/> <br/> <br/> <br/>
        </div>
      </div>

      <%= render partial: 'shared/botonera', locals:{ object: f, cancel_route: mirepuestos_path } %>
    <% end %>
  </div>
</div>



<script>
    var ready;
    ready = function() {

        $('#extra_state_id').on('change', function() {

            $('#truck_city_id option').html('')
            function loader(data){
                $('#truck_city_id option').html('Cargando...')
            };

            function error(data){
                alert("Error enviados los datos");
            };



            $.ajax({
                async: true,
                type: "GET",
                dataType: 'json',
                beforeSend:loader,
                error:error,
                success: function (msg) {


                    $('#extra_city_id').html('')


                    $.each(msg, function(index, value) {
                        console.log('<option value="'+value.id+'">'+value.name+'</option>');
                        $('#extra_city_id').append('<option value="'+value.id+'">'+value.name+'</option>')
                    });

                },
                url:"/admin/states/"+this.value+"/cities.json"
            });





        });

    };

    $(document).ready(ready);
    $(document).on('page:load', ready);

</script>